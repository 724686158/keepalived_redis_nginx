global_defs {
    lvs_id LVS_redis
}

vrrp_script chk_redis {
	script "/etc/keepalived/scripts/redis_check.sh"
	interval 2
	timeout 2
	fall 3
}

vrrp_script chk_nginx_health {
        script "/etc/keepalived/scripts/nginx_curl.sh"
        interval 2
        fall 3
        rise 2
}

vrrp_instance rk {
        state BACKUP
        interface eth0
        virtual_router_id 54
        priority 98
        advert_int  1
        unicast_src_ip 10.211.55.6
        unicast_peer {
            10.211.55.5
        }
        authentication {
            auth_type PASS
            auth_pass 123456
        }
        track_script {
            chk_redis
	    chk_nginx_health
        }
        virtual_ipaddress {
            # Replace with Virtual IP
            10.211.55.10
        }
        # Configure master and backup IPs
        notify_master "/etc/keepalived/scripts/redis_master.sh 10.211.55.10 6379"
        notify_backup "/etc/keepalived/scripts/redis_backup.sh 10.211.55.5 6379"
        notify_fault  /etc/keepalived/scripts/redis_fault.sh
        notify_stop   /etc/keepalived/scripts/redis_stop.sh
	notify  /etc/keepalived/scripts/nginx_notify.sh
        notify  /etc/keepalived/scripts/nginx_service_notify.sh
}

